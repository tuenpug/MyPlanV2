<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3416 æˆ°ç•¥çµ‚ç«¯ Pro (è‡ªå‹•å„²å­˜ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
        .mono { font-family: 'SF Mono', 'JetBrains Mono', monospace; }
        .active-btn:active { transform: scale(0.96); transition: 0.1s; }
        input, select { -webkit-appearance: none; border-radius: 1rem; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-10">

    <div class="bg-slate-900 text-white p-6 rounded-b-[2.5rem] shadow-xl">
        <div class="flex justify-between items-center mb-2">
            <span class="text-[10px] font-bold opacity-50 tracking-widest uppercase">Portfolio Value</span>
            <span id="lastUpdate" class="text-[10px] opacity-40 mono">--:--</span>
        </div>
        <div class="flex items-baseline gap-2 mb-4">
            <h1 id="totalEquity" class="text-4xl font-black mono">$1,000,000</h1>
            <span id="totalRoi" class="text-emerald-400 font-bold text-sm">+0.0%</span>
        </div>
        <div class="grid grid-cols-2 gap-4 border-t border-white/10 pt-4">
            <div>
                <p class="text-[10px] opacity-50 uppercase font-bold text-emerald-300">æµå‹•ç¾é‡‘</p>
                <p id="cashBal" class="text-lg font-bold mono">$1,000,000</p>
            </div>
            <div class="text-right">
                <p class="text-[10px] opacity-50 uppercase font-bold">æœ€å¤§å›æ’¤</p>
                <p id="maxDD" class="text-lg font-bold mono text-rose-400">0.0%</p>
            </div>
        </div>
    </div>

    <div class="px-4 -mt-4 space-y-4">
        <div class="bg-white rounded-3xl p-5 shadow-lg border border-slate-100 flex items-center">
            <div class="w-1/2 h-32"><canvas id="allocChart"></canvas></div>
            <div class="w-1/2 pl-4 space-y-1">
                <h3 class="text-[10px] font-black text-slate-400 uppercase mb-2 tracking-widest">è³‡ç”¢ä½”æ¯”</h3>
                <div class="flex items-center gap-2 text-[9px] font-bold"><span class="w-2 h-2 rounded-full bg-blue-500"></span> ä»½é¡ 1 (é•·)</div>
                <div class="flex items-center gap-2 text-[9px] font-bold"><span class="w-2 h-2 rounded-full bg-amber-500"></span> ä»½é¡ 2 (çŸ­)</div>
                <div class="flex items-center gap-2 text-[9px] font-bold"><span class="w-2 h-2 rounded-full bg-rose-500"></span> ä»½é¡ 3 (åº•)</div>
                <div class="flex items-center gap-2 text-[9px] font-bold"><span class="w-2 h-2 rounded-full bg-slate-200"></span> æµå‹•ç¾é‡‘</div>
            </div>
        </div>

        <div id="decisionCard" class="bg-white rounded-3xl p-5 shadow-md border border-slate-100">
            <div class="flex justify-between items-center mb-2">
                <div class="flex items-center gap-2">
                    <span id="decisionEmoji" class="text-xl">â˜•</span>
                    <h2 id="decisionTitle" class="font-bold text-slate-800 text-xs uppercase">åˆ†æä¸­</h2>
                </div>
                <span id="yieldVal" class="text-xl font-black mono text-emerald-600">--%</span>
            </div>
            <p id="decisionText" class="text-[11px] text-slate-500 leading-tight">--</p>
        </div>

        <div class="bg-white rounded-[2rem] p-5 shadow-sm border border-slate-100">
            <div class="space-y-3">
                <div class="flex items-center gap-2 bg-emerald-50 p-3 rounded-2xl border border-emerald-100">
                    <span class="text-xs font-bold text-emerald-700 whitespace-nowrap">æ¯æœˆæ´¾æ¯: $</span>
                    <input type="number" id="divSetting" value="0.14" step="0.01" oninput="updateDecision()" class="w-full bg-transparent font-black mono text-emerald-700 outline-none text-right">
                </div>

                <select id="bucket" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-sm outline-none border-0 uppercase tracking-tighter text-slate-600">
                    <option value="b1">ä»½é¡ 1: é•·ç·šæ ¸å¿ƒ (40%)</option>
                    <option value="b2">ä»½é¡ 2: çŸ­ç·šæ³¢æ®µ (30%)</option>
                    <option value="b3">ä»½é¡ 3: æ’ˆåº•å„²å‚™ (30%)</option>
                </select>

                <div class="grid grid-cols-2 gap-2 text-center">
                    <div class="bg-slate-50 rounded-2xl p-2 relative">
                        <span class="text-[8px] font-bold text-slate-400 uppercase absolute top-2 left-0 right-0">å¸‚åƒ¹</span>
                        <input type="number" id="price" value="10.60" step="0.01" oninput="updateDecision()" class="w-full pt-4 bg-transparent font-mono font-bold text-center outline-none">
                    </div>
                    <div class="bg-slate-50 rounded-2xl p-2 relative">
                        <span class="text-[8px] font-bold text-slate-400 uppercase absolute top-2 left-0 right-0">è‚¡æ•¸</span>
                        <input type="number" id="shares" value="10000" class="w-full pt-4 bg-transparent font-mono font-bold text-center outline-none">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2 pt-2">
                    <button onclick="trade('BUY')" class="active-btn bg-slate-900 text-white font-black py-4 rounded-2xl shadow-lg text-xs uppercase">è²·å…¥é€²å ´</button>
                    <button onclick="trade('SELL')" class="active-btn bg-white border-2 border-slate-900 font-bold py-4 rounded-2xl text-xs uppercase">æ²½å‡ºç²åˆ©</button>
                </div>
                <button onclick="collectDiv()" class="active-btn w-full bg-emerald-500 text-white font-black py-4 rounded-2xl shadow-md flex justify-center items-center gap-2">
                    <span>ğŸ’° é ˜å–æœ¬æœˆè‚¡æ¯</span>
                </button>
            </div>
        </div>

        <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden mb-10">
            <div class="px-6 py-4 bg-slate-50 border-b flex justify-between items-center">
                <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">äº¤æ˜“æ—¥è¨˜ç°¿</span>
                <button onclick="resetData()" class="text-[9px] font-bold bg-rose-100 text-rose-600 px-3 py-1 rounded-full uppercase active-btn">é‡è¨­ç³»çµ±</button>
            </div>
            <div id="logBody" class="divide-y text-[10px] max-h-64 overflow-y-auto">
                </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–ç‹€æ…‹ (å„ªå…ˆå¾ LocalStorage è®€å–)
        let state = JSON.parse(localStorage.getItem('3416_state')) || {
            cash: 1000000,
            holding: { b1: 0, b2: 0, b3: 0 },
            peak: 1000000,
            logs: []
        };

        let allocChart;

        function saveState() {
            localStorage.setItem('3416_state', JSON.stringify(state));
        }

        function resetData() {
            if(confirm("è­¦å‘Šï¼šé€™å°‡æ¸…ç©ºæ‰€æœ‰äº¤æ˜“è¨˜éŒ„ä¸¦æ¢å¾© 100 è¬ç¾é‡‘ã€‚ç¢ºå®šå—ï¼Ÿ")) {
                localStorage.removeItem('3416_state');
                location.reload();
            }
        }

        function initCharts() {
            const ctx = document.getElementById('allocChart').getContext('2d');
            allocChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ä»½é¡1', 'ä»½é¡2', 'ä»½é¡3', 'ç¾é‡‘'],
                    datasets: [{
                        data: [0, 0, 0, 1],
                        backgroundColor: ['#3b82f6', '#f59e0b', '#f43f5e', '#f1f5f9'],
                        borderWidth: 0
                    }]
                },
                options: { maintainAspectRatio: false, cutout: '75%', plugins: { legend: { display: false } } }
            });
            updateUI(); // åˆæ¬¡åŠ è¼‰æ•¸æ“š
        }

        function updateDecision() {
            const p = parseFloat(document.getElementById('price').value) || 10.6;
            const currentDiv = parseFloat(document.getElementById('divSetting').value) || 0.14;
            const y = ((currentDiv * 12) / p * 100).toFixed(1);
            document.getElementById('yieldVal').innerText = y + "%";
            
            const card = document.getElementById('decisionCard');
            const title = document.getElementById('decisionTitle');
            const text = document.getElementById('decisionText');
            const emoji = document.getElementById('decisionEmoji');

            if (y >= 18.5) {
                card.className = "bg-emerald-50 rounded-3xl p-5 border-2 border-emerald-500 shadow-md transition-all";
                title.innerText = "ğŸš¨ çµ•ä½³æ©Ÿæœƒ (ä»½é¡3)";
                text.innerText = "è‚¡æ¯ç‡æ¥µé«˜ï¼Œæ­·å²æ€§ä½ä½ï¼Œå»ºè­°å‹•ç”¨æ’ˆåº•è³‡é‡‘ã€‚";
                emoji.innerText = "ğŸŒŸ";
            } else if (y >= 16.5) {
                card.className = "bg-blue-50 rounded-3xl p-5 border-2 border-blue-500 shadow-md transition-all";
                title.innerText = "ğŸ“ˆ æ³¢æ®µæ“ä½œ (ä»½é¡2)";
                text.innerText = "è‚¡æ¯ç‡å…·å¸å¼•åŠ›ï¼Œé©åˆçŸ­ç·šé€²å ´è³ºå–åå½ˆã€‚";
                emoji.innerText = "âœ…";
            } else {
                card.className = "bg-white rounded-3xl p-5 shadow-md border border-slate-100 transition-all";
                title.innerText = "ğŸ§˜ ç©©å®šæ”¶æ¯ (ä»½é¡1)";
                text.innerText = "è‚¡åƒ¹è™•æ–¼æ­£å¸¸å€é–“ï¼Œæ ¸å¿ƒå€‰ä½è«‹è€å¿ƒæŒè‚¡æ”¶æ¯ã€‚";
                emoji.innerText = "â˜•";
            }
        }

        function trade(type) {
            const p = parseFloat(document.getElementById('price').value);
            const s = parseInt(document.getElementById('shares').value);
            const b = document.getElementById('bucket').value;
            const amt = p * s;

            if (type === 'BUY') {
                if (state.cash < amt) return alert("æµå‹•ç¾é‡‘ä¸è¶³!");
                state.cash -= amt; state.holding[b] += s;
                log(`è²·å…¥ ${s.toLocaleString()}è‚¡ (${b})`, -amt);
            } else {
                if (state.holding[b] < s) return alert("æŒå€‰ä¸è¶³!");
                state.cash += amt; state.holding[b] -= s;
                log(`æ²½å‡º ${s.toLocaleString()}è‚¡ (${b})`, amt);
            }
            updateUI();
            saveState();
        }

        function collectDiv() {
            const currentDiv = parseFloat(document.getElementById('divSetting').value);
            const totalS = state.holding.b1 + state.holding.b2 + state.holding.b3;
            if (totalS <= 0) return alert("ç•¶å‰æ²’æœ‰ä»»ä½•æŒå€‰");
            const div = totalS * currentDiv;
            state.cash += div;
            log(`æ”¶æ¯ ${totalS.toLocaleString()}è‚¡ (@$${currentDiv})`, div);
            updateUI();
            saveState();
        }

        function log(msg, amt) {
            const entry = { time: new Date().toLocaleTimeString().slice(0,5), msg, amt };
            state.logs.unshift(entry);
            if (state.logs.length > 50) state.logs.pop(); // åªä¿ç•™æœ€è¿‘ 50 æ¢è¨˜éŒ„
            renderLogs();
        }

        function renderLogs() {
            const logHTML = state.logs.map(l => `
                <div class="p-4 flex justify-between items-center bg-white px-6">
                    <span class="text-slate-400 mono text-[8px]">${l.time}</span>
                    <span class="font-bold text-slate-700 uppercase tracking-tighter">${l.msg}</span>
                    <span class="font-black mono ${l.amt>=0?'text-emerald-500':'text-slate-900'}">${l.amt>=0?'+':''}${Math.round(l.amt).toLocaleString()}</span>
                </div>
            `).join('');
            document.getElementById('logBody').innerHTML = logHTML;
        }

        function updateUI() {
            const p = parseFloat(document.getElementById('price').value) || 10.6;
            const v1 = state.holding.b1 * p;
            const v2 = state.holding.b2 * p;
            const v3 = state.holding.b3 * p;
            const eq = state.cash + v1 + v2 + v3;
            const roi = ((eq - 1000000) / 1000000 * 100).toFixed(1);
            if (eq > state.peak) state.peak = eq;
            const dd = ((state.peak - eq) / state.peak * 100).toFixed(1);

            document.getElementById('totalEquity').innerText = "$" + Math.round(eq).toLocaleString();
            document.getElementById('totalRoi').innerText = (roi >= 0 ? "+" : "") + roi + "%";
            document.getElementById('cashBal').innerText = "$" + Math.round(state.cash).toLocaleString();
            document.getElementById('maxDD').innerText = dd + "%";
            document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString().slice(0,5);

            allocChart.data.datasets[0].data = [v1, v2, v3, state.cash];
            allocChart.update();
            renderLogs();
            updateDecision();
        }

        window.onload = initCharts;
    </script>
</body>
</html>